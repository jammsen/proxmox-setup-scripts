arch: amd64
cores: 8
features: nesting=1
hostname: ollama-docker-nvidia
memory: 8192
net0: name=eth0,bridge=vmbr0,firewall=1,gw=10.0.0.1,hwaddr=BC:24:11:06:F0:44,ip=10.0.0.231/24,type=veth
ostype: ubuntu
rootfs: local-zfs:subvol-231-disk-0,size=160G
swap: 4096
tags: docker;gpu;ollama
# ===== NVIDIA GPU Passthrough Configuration =====
# PCI Address: 0000:c7:00.0
# Allow access to cgroup devices (NVIDIA and DRI)
lxc.cgroup2.devices.allow: c 195:* rwm
lxc.cgroup2.devices.allow: c 226:* rwm
lxc.cgroup2.devices.allow: c 234:* rwm
lxc.cgroup2.devices.allow: c 237:* rwm
lxc.cgroup2.devices.allow: c 238:* rwm
lxc.cgroup2.devices.allow: c 239:* rwm
lxc.cgroup2.devices.allow: c 240:* rwm
lxc.cgroup2.devices.allow: c 508:* rwm
# Mount NVIDIA devices
lxc.mount.entry: /dev/nvidia0 dev/nvidia0 none bind,optional,create=file
lxc.mount.entry: /dev/nvidiactl dev/nvidiactl none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-modeset dev/nvidia-modeset none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-uvm dev/nvidia-uvm none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-uvm-tools none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-caps/nvidia-cap1 dev/nvidia-caps/nvidia-cap1 none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-caps/nvidia-cap2 dev/nvidia-caps/nvidia-cap2 none bind,optional,create=file
# Mount DRI devices using persistent PCI paths
lxc.mount.entry: /dev/dri/by-path/pci-0000:c7:00.0-card dev/dri/card0 none bind,optional,create=file
lxc.mount.entry: /dev/dri/by-path/pci-0000:c7:00.0-render dev/dri/renderD128 none bind,optional,create=file
# Allow system-level capabilities for GPU drivers
lxc.apparmor.profile: unconfined
lxc.cap.drop:
# ===== End GPU Configuration =====